# üß™ COMPLETE AUTH FLOW TESTING GUIDE

**Date:** October 23, 2025  
**Status:** Ready for Testing  
**Estimated Time:** 10 minutes  

---

## ‚úÖ PRE-FLIGHT CHECKLIST

### **1. Verify All Services Running**

**API Server (Port 3001):**
```bash
# Check terminal for:
‚úÖ Database connected successfully
‚úÖ SERVER STARTED SUCCESSFULLY
üåê Server running on port: 3001
```

**Owner Portal (Port 3000):**
```bash
# Check terminal for:
‚úÖ Compiled successfully!
‚úÖ webpack compiled successfully
‚úÖ No issues found.
```

**Database (Supabase):**
- ‚úÖ Project status: ACTIVE
- ‚úÖ Database connection: Established

---

## üéØ TEST SCENARIOS

### **SCENARIO 1: Demo Account Registration + Login (HAPPY PATH)**

#### **Step 1: Open Login Page**
```
URL: http://localhost:3000/login
```

**Expected:**
- ‚úÖ Blue-themed login page loads
- ‚úÖ "Library Owner Portal" title visible
- ‚úÖ Email/Password fields present
- ‚úÖ "Try Demo Account" button (green)
- ‚úÖ Social login buttons (Google/GitHub)

---

#### **Step 2: Click "Try Demo Account"**

**Expected Behavior:**
1. üîÑ Snackbar appears: "Setting up demo account..."
2. ‚úÖ Snackbar appears: "Demo account created!" (if first time)
3. ‚úÖ Snackbar appears: "Welcome to Demo Account!"
4. üîÑ Page redirects to `/dashboard`
5. ‚úÖ Dashboard loads with user data

**Credentials (auto-filled):**
```
Email: owner@demo.com
Password: Demo123456
Role: library_owner
```

---

#### **Step 3: Verify Dashboard Access**

**Expected:**
- ‚úÖ Dashboard page loads
- ‚úÖ User info in header (Demo Owner)
- ‚úÖ Navigation menu visible
- ‚úÖ No error messages
- ‚úÖ Token stored in localStorage

**Check Browser DevTools (F12 ‚Üí Application ‚Üí Local Storage):**
```
auth_token: eyJhbGc...  (JWT token)
refresh_token: eyJhbGc...  (Refresh token)
user_data: { "id": "...", "email": "owner@demo.com", ... }
```

---

### **SCENARIO 2: Manual Login (Existing User)**

#### **Step 1: Logout**
- Click profile icon ‚Üí Logout
- Verify redirect to `/login`
- Check localStorage cleared

#### **Step 2: Manual Login**
```
Email: owner@demo.com
Password: Demo123456
```

**Expected:**
- ‚úÖ Login successful
- ‚úÖ Redirect to dashboard
- ‚úÖ User session restored

---

### **SCENARIO 3: Invalid Credentials (ERROR PATH)**

#### **Step 1: Wrong Password**
```
Email: owner@demo.com
Password: WrongPassword123
```

**Expected:**
- ‚ùå Snackbar appears: "Invalid credentials"
- ‚ùå Stay on login page
- ‚ùå No tokens in localStorage

---

#### **Step 2: Non-existent User**
```
Email: nonexistent@example.com
Password: AnyPassword123
```

**Expected:**
- ‚ùå Snackbar appears: "Invalid credentials"
- ‚ùå Stay on login page

---

### **SCENARIO 4: Token Refresh (AUTOMATIC)**

#### **Step 1: Simulate Token Expiry**
1. Open Browser DevTools (F12)
2. Go to Application ‚Üí Local Storage
3. Edit `auth_token` value to invalid token
4. Make any API request (navigate to different page)

**Expected:**
- ‚úÖ Automatic token refresh triggered
- ‚úÖ New token fetched using refresh token
- ‚úÖ Page loads successfully
- ‚úÖ No logout/redirect

---

### **SCENARIO 5: Profile Access**

#### **Step 1: View Profile**
- Click profile icon ‚Üí Profile/Settings
- Navigate to `/profile`

**Expected:**
- ‚úÖ Profile page loads
- ‚úÖ User data displayed correctly:
  - Email: owner@demo.com
  - Name: Demo Owner
  - Role: library_owner
  - Phone: +1234567890

---

### **SCENARIO 6: API Response Validation**

#### **Open Browser DevTools (F12 ‚Üí Network Tab)**

**During Demo Account Login, check:**

**1. POST /api/auth/register Request:**
```json
{
  "email": "owner@demo.com",
  "password": "Demo123456",
  "firstName": "Demo",
  "lastName": "Owner",
  "phone": "+1234567890",
  "role": "library_owner"
}
```

**2. POST /api/auth/register Response (201):**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "email": "owner@demo.com",
      "firstName": "Demo",
      "lastName": "Owner",
      "role": "library_owner",
      "status": "active"
    },
    "tokens": {
      "accessToken": "eyJhbGc...",
      "refreshToken": "eyJhbGc...",
      "expiresIn": "24h"
    }
  }
}
```

**3. POST /api/auth/login Request:**
```json
{
  "email": "owner@demo.com",
  "password": "Demo123456"
}
```

**4. POST /api/auth/login Response (200):**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "email": "owner@demo.com",
      "firstName": "Demo",
      "lastName": "Owner",
      "role": "library_owner",
      "lastLogin": "2025-10-23T..."
    },
    "tokens": {
      "accessToken": "eyJhbGc...",
      "refreshToken": "eyJhbGc...",
      "expiresIn": "24h"
    }
  }
}
```

**5. GET /api/auth/me Request:**
```
Headers:
Authorization: Bearer eyJhbGc...
```

**6. GET /api/auth/me Response (200):**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "email": "owner@demo.com",
      "firstName": "Demo",
      "lastName": "Owner",
      "role": "library_owner",
      "tenantId": "default-tenant"
    }
  }
}
```

---

## üêõ TROUBLESHOOTING

### **Issue: "ERR_CONNECTION_REFUSED"**

**Solution:**
1. Check if Owner Portal is running on port 3000
2. Check terminal for compilation errors
3. Try: http://127.0.0.1:3000/login
4. Clear browser cache

---

### **Issue: "Invalid credentials" on Demo Account**

**Solution:**
1. Check browser console for exact error
2. Check API logs for request details
3. Verify database connection
4. Check CORS configuration

---

### **Issue: Dashboard redirects back to login**

**Possible Causes:**
- ‚ùå Token not stored in localStorage
- ‚ùå Token format incorrect
- ‚ùå API response structure mismatch
- ‚ùå Auth middleware rejecting token

**Solution:**
1. Open DevTools (F12) ‚Üí Console
2. Check for errors
3. Go to Application ‚Üí Local Storage
4. Verify `auth_token` exists and looks like: `eyJhbGc...`
5. Check Network tab for 401 errors

---

### **Issue: Snackbar shows "Demo login failed: [error]"**

**Solutions by Error:**

**"User already exists":**
- ‚úÖ This is OK! The account was created before
- ‚úÖ It will auto-login anyway

**"Invalid role":**
- ‚ùå Backend validation issue
- ‚úÖ Already fixed in commit 8f4dc2e

**"Validation failed":**
- ‚ùå Missing required fields
- ‚úÖ Already fixed in commit 0adb190

**Network Error:**
- ‚ùå API server not running
- ‚ùå CORS configuration issue
- Check API server terminal

---

## ‚úÖ SUCCESS CRITERIA

After completing all scenarios, you should have:

1. ‚úÖ Demo account registered successfully
2. ‚úÖ Login working with correct credentials
3. ‚úÖ Error messages for wrong credentials
4. ‚úÖ Dashboard accessible
5. ‚úÖ Profile data displaying correctly
6. ‚úÖ Logout working properly
7. ‚úÖ Token refresh working automatically
8. ‚úÖ All Snackbar messages appearing correctly

---

## üìä TESTING CHECKLIST

Use this checklist while testing:

### **Authentication Flow:**
- [ ] Demo account button works
- [ ] Registration successful (first time)
- [ ] Login successful (returning user)
- [ ] Error handling for wrong password
- [ ] Error handling for non-existent user
- [ ] Logout works correctly
- [ ] Session persists on page refresh

### **Token Management:**
- [ ] Access token stored in localStorage
- [ ] Refresh token stored in localStorage
- [ ] Token sent with API requests
- [ ] Token refresh on 401 error
- [ ] Tokens cleared on logout

### **UI/UX:**
- [ ] Snackbar messages appear
- [ ] Loading states visible
- [ ] Form validation working
- [ ] Navigation after login
- [ ] Protected routes working
- [ ] Role-based access control

### **API Integration:**
- [ ] /api/auth/register endpoint
- [ ] /api/auth/login endpoint
- [ ] /api/auth/me endpoint
- [ ] /api/auth/refresh endpoint
- [ ] /api/auth/logout endpoint
- [ ] Error responses formatted correctly

---

## üöÄ NEXT STEPS AFTER TESTING

### **If All Tests Pass:**
1. ‚úÖ Commit any final changes
2. ‚úÖ Update PRODUCTION_READY_REVIEW.md
3. ‚úÖ Deploy to Vercel (Owner Portal)
4. ‚úÖ Deploy to Vercel (Admin Portal)
5. ‚úÖ Test on production URLs

### **If Tests Fail:**
1. ‚ùå Note the specific scenario that failed
2. ‚ùå Check browser console for errors
3. ‚ùå Check API logs for backend errors
4. ‚ùå Share error details for troubleshooting
5. ‚ùå Fix issues before deployment

---

## üìù TEST REPORT TEMPLATE

After testing, fill this out:

```
TEST REPORT
Date: ___________
Tester: ___________

SCENARIO 1 (Demo Account): [ PASS / FAIL ]
Notes: ___________

SCENARIO 2 (Manual Login): [ PASS / FAIL ]
Notes: ___________

SCENARIO 3 (Invalid Creds): [ PASS / FAIL ]
Notes: ___________

SCENARIO 4 (Token Refresh): [ PASS / FAIL ]
Notes: ___________

SCENARIO 5 (Profile Access): [ PASS / FAIL ]
Notes: ___________

SCENARIO 6 (API Validation): [ PASS / FAIL ]
Notes: ___________

OVERALL STATUS: [ READY FOR PRODUCTION / NEEDS FIXES ]

ISSUES FOUND:
1. ___________
2. ___________
3. ___________
```

---

## üéØ READY TO TEST?

**Start Here:**
1. Open browser to: http://localhost:3000/login
2. Click "Try Demo Account"
3. Watch for Snackbar messages
4. Verify dashboard loads

**Report back:**
- ‚úÖ All tests passed
- ‚ùå Specific scenario failed (with error details)

**LET'S TEST!** üöÄ

